# Preqreuisites

- dfx 0.24.3
- node 22.12.0
- npm 10.9.0
- `pocket-ic` binary present in `/usr/local/bin/pocket-ic` (make sure it's executable)

# Lifecycle

The canister's lifecycle methods are managed in `src/backend/src/lifecycle.rs`. The `init` method in `main.rs` is called when the canister is created, and the `post_upgrade` method in `main.rs` is called after the canister is upgraded. Currently they both share the same implementation, that is when upgrading the canister you have to provide the same arguments as when creating the canister.

# State

The application has a state that is stored in the canister. The state is a struct that is defined in `src/backend/src/state.rs`. The state state is lost when the canister is being upgraded. For data that should be persisted, use refer to the `Storage` section.

# Storage

Data that is supposed to survive canister upgrades is defined in `src/backend/src/storage.rs`. The data is stored in the canister's stable memory and is not lost when the canister is being upgraded. This is faciliated by using the `ic-stable-structures` crate released by DFINITY.

# Logging

There are two levels of logging in the application:

- INFO: General information about the application
- DEBUG: Detailed information about the application

To emit a log message, use the following syntax:

```rust
log!(INFO, "Received a request to fetch logs");
log!(DEBUG, "Received a request to fetch logs");
```

Logs in query calls are not persisted.

You can access canister logs via http requests to the canister's `/logs` endpoint. It accepts the following query parameters:

- `priority`: The log level to filter by. Possible values are `info` and `debug`.
- `time`: Accepts a timestamp in nanoseconds. Only logs after this timestamp will be returned.
- `sort`: The order in which logs are returned. Possible values are `asc` and `desc`. Default is `asc` when `time` is not provided, and `desc` otherwise.

# Metrics

There are different metrics exposed via http requests to the canister's `/metrics` endpoint. You can modify them in `src/backend/src/metrics.rs`

# Dashboard

The application has a dashboard that can be accessed via http requests to the canisters the `/dashboard` endpoint. It currently only exposes the way the user is greeted when calling `greet`. You can modify the `askama` dashboard template in `src/backend/dashboard.rs` and the corresponding HTML in `src/backend/templates/dashboard.html`.

# Candid Interface

The canisters candid file is generated by leveraging the `ic_cdk::export_candid!()` macro and `candid-extractor`. You can read more about this approach [here](https://internetcomputer.org/docs/current/developer-docs/backend/rust/generating-candid/).
